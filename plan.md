# 開発計画

SimpleVisualSLAMの段階的な開発計画です。

## Phase 1: 基本構造とデータ型 (完了)
- [x] コアクラスの定義: `Camera`, `Frame`, `Keyframe`, `Landmark`, `Map`.
- [x] 基本IOの実装: `MapIO` (スタブ).
- [x] アプリケーションエントリポイントの作成: `apps/run_mono.cc`.
- [x] OpenCV (ORB特徴抽出) と Sophus の統合.

## Phase 2: トラッキング (Tracking) (次)
- [ ] **等速運動モデル**: 前フレームの速度から現在のカメラ姿勢を予測する。
- [ ] **参照キーフレーム追跡**: 現在のフレームと直近のキーフレーム間で特徴点マッチングを行う。
- [ ] **局所地図追跡**:
    - 共視グラフ(Covisibility Graph)上の近傍キーフレームから、ランドマークを現在フレームに投影。
    - Ceres Solverを用いて姿勢を最適化 (再投影誤差の最小化)。
- [ ] **キーフレーム決定**: 新しいキーフレームを挿入するかどうかの判定 (例: 追跡点数が閾値を下回った場合など)。

## Phase 3: 初期化 (Initialization)
- [ ] **単眼初期化**:
    - 並列して2フレーム間のホモグラフィ行列(H)と基本行列(F)を計算。
    - モデル選択を行い、運動(R, t)に分解。
    - 初期のランドマークを三角測量(Triangulation)で生成。
    - 初期のMapとKeyframeを作成。

## Phase 4: 局所マッピング (Local Mapping / Backend)
- [ ] **キーフレーム挿入**: 新しいキーフレームをMapに追加し、接続関係を更新。
- [ ] **マップポイント選別**: 重複や品質の悪いマップポイントを削除 (Culling)。
- [ ] **新規マップポイント作成**: 接続されたキーフレーム間で未マッチの特徴点から新規点を三角測量。
- [ ] **局所バンドル調整 (Local BA)**:
    - 直近のキーフレームと観測されるランドマークを最適化。
    - Ceres Solverを使用 (Schur Complementなどを活用)。

## Phase 5: ループクロージャ (Loop Closure)
- [ ] **DBoW2 統合**:
    - ORB記述子をBoWベクトルに変換。
    - 語彙データベース(Vocabulary)の構築/ロード。
- [ ] **ループ検出**:
    - データベースから候補を検索。
    - 幾何検証 (Sim3最適化)。
- [ ] **ループ補正**:
    - ポーズグラフ最適化 (Pose Graph Optimization) で誤差を分散。
    - 地図の修正。

## Phase 6: 永続化 (Persistence)
- [ ] **シリアライズ**:
    - Map (Keyframes, Landmarks, Graph) のバイナリ/テキスト保存実装。
    - 再開のためのロード機能実装。
